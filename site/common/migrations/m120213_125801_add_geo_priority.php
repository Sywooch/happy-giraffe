<?php

class m120213_125801_add_geo_priority extends CDbMigration
{
    private $_table = 'geo_country';

    public function up()
    {
        $this->addColumn($this->_table, 'iso_code', 'varchar(2)');
        $this->addColumn($this->_table, 'pos', 'int');
        $this->truncateTable($this->_table);
        $this->execute("INSERT INTO `geo_country` (`id`, `name`, `pos`, `iso_code`) VALUES
(1, 'Афганистан', 140, 'AF'),
(2, 'Аландские острова', 318, 'AX'),
(3, 'Албания', 240, 'AL'),
(4, 'Алжир', 134, 'DZ'),
(5, 'Американское Самоа', 308, 'AS'),
(6, 'Андорра', 300, 'AD'),
(7, 'Ангола', 159, 'AO'),
(8, 'Ангилья', 324, 'AI'),
(9, 'Антигуа и Барбуда', 298, 'AG'),
(10, 'Аргентина', 132, 'AR'),
(11, 'Армения', 236, 'AM'),
(12, 'Аруба', 296, 'AW'),
(13, 'Австралия', 152, 'AU'),
(14, 'Австрия', 192, 'AT'),
(15, 'Азербайджан', 190, 'AZ'),
(16, 'Багамы', 276, 'BS'),
(17, 'Бахрейн', 254, 'BH'),
(18, 'Бангладеш', 108, 'BD'),
(19, 'Барбадос', 279, 'BB'),
(20, 'Белоруссия', 3, 'BY'),
(21, 'Бельгия', 176, 'BE'),
(22, 'Белиз', 277, 'BZ'),
(23, 'Бенин', 191, 'BJ'),
(24, 'Бермуды', 306, 'BM'),
(25, 'Бутан', 263, 'BT'),
(26, 'Боливия', 177, 'BO'),
(27, 'Босния и Герцеговина', 227, 'BA'),
(28, 'Ботсвана', 247, 'BW'),
(29, 'Бразилия', 104, 'BR'),
(30, 'Британские Виргинские Острова', 319, 'VG'),
(31, 'Бруней', 272, 'BN'),
(32, 'Болгария', 200, 'BG'),
(33, 'Буркина Фасо', 163, 'BF'),
(34, 'Бурунди', 182, 'BI'),
(35, 'Камбоджа', 167, 'KH'),
(36, 'Камерун', 158, 'CM'),
(37, 'Канада', 136, 'CA'),
(38, 'Кабо-Верде', 266, 'CV'),
(39, 'Карибские Нидерланды', 322, 'BQ'),
(40, 'Каймановы Острова', 309, 'KY'),
(41, 'Центральноафриканская Республика', 221, 'CF'),
(42, 'Чад', 181, 'TD'),
(43, 'Чили', 160, 'CL'),
(44, 'Китай', 100, 'CN'),
(45, 'Остров Рождества', 332, 'CX'),
(46, 'Кокосовые Острова', 334, 'CC'),
(47, 'Колумбия', 128, 'CO'),
(48, 'Коморы', 262, 'KM'),
(49, 'Конго', 230, 'CG'),
(50, 'Острова Кука', 321, 'CK'),
(51, 'Коста-Рика', 223, 'CR'),
(52, 'Кот-д’Ивуар', 156, 'CI'),
(53, 'Хорватия', 224, 'HR'),
(54, 'Куба', 175, 'CU'),
(55, 'Кюрасао', 289, 'CW'),
(56, 'Кипр', 260, 'CY'),
(57, 'Чехия', 179, 'CZ'),
(58, 'Демократическая Республика Конго', 118, 'CD'),
(59, 'Дания', 212, 'DK'),
(60, 'Джибути', 258, 'DJ'),
(61, 'Доминика', 303, 'DM'),
(62, 'Доминиканская Республика', 189, 'DO'),
(63, 'Эквадор', 165, 'EC'),
(64, 'Египет', 115, 'EG'),
(65, 'Сальвадор', 208, 'SV'),
(66, 'Экваториальная Гвинея', 264, 'GQ'),
(67, 'Эритрея', 210, 'ER'),
(68, 'Эстония', 252, 'EE'),
(69, 'Эфиопия', 113, 'ET'),
(70, 'Фолклендские острова', 330, 'FK'),
(71, 'Фарерские острова', 311, 'FO'),
(72, 'Фиджи', 259, 'FJ'),
(73, 'Финляндия', 215, 'FI'),
(74, 'Франция', 120, 'FR'),
(75, 'Французская Гвиана', 283, 'GF'),
(76, 'Французская Полинезия', 280, 'PF'),
(77, 'Габон', 251, 'GA'),
(78, 'Гамбия', 248, 'GM'),
(79, 'Грузия', 219, 'GE'),
(80, 'Германия', 114, 'DE'),
(81, 'Гана', 147, 'GH'),
(82, 'Греция', 174, 'GR'),
(83, 'Гренландия', 307, 'GL'),
(84, 'Гренада', 292, 'GD'),
(85, 'Гваделупа', 273, 'GP'),
(86, 'Гуам', 286, 'GU'),
(87, 'Гватемала', 169, 'GT'),
(88, 'Гернси', 305, 'GG'),
(89, 'Гвинея', 183, 'GN'),
(90, 'Гвинея-Бисау', 250, 'GW'),
(91, 'Гайана', 199, 'GY'),
(92, 'Гаити', 186, 'HT'),
(93, 'Гондурас', 195, 'HN'),
(94, 'Гонконг', 202, 'HK'),
(95, 'Венгрия', 184, 'HU'),
(96, 'Исландия', 278, 'IS'),
(97, 'Индия', 101, 'IN'),
(98, 'Индонезия', 103, 'ID'),
(99, 'Иран', 116, 'IR'),
(100, 'Ирак', 139, 'IQ'),
(101, 'Ирландия', 220, 'IE'),
(102, 'Остров Мэн', 299, 'IM'),
(103, 'Израиль', 198, 'IL'),
(104, 'Италия', 123, 'IT'),
(105, 'Ямайка', 239, 'JM'),
(106, 'Япония', 109, 'JP'),
(107, 'Джерси', 297, 'JE'),
(108, 'Иордания', 206, 'JO'),
(109, 'Казахстан', 4, 'KZ'),
(110, 'Кения', 131, 'KE'),
(111, 'Кирибати', 295, 'KI'),
(112, 'Кувейт', 232, 'KW'),
(113, 'Киргизия', 213, 'KG'),
(114, 'Лаос', 203, 'LA'),
(115, 'Латвия', 242, 'LV'),
(116, 'Ливан', 225, 'LB'),
(117, 'Лесото', 244, 'LS'),
(118, 'Либерия', 228, 'LR'),
(119, 'Ливия', 211, 'LY'),
(120, 'Лихтенштейн', 315, 'LI'),
(121, 'Литва', 237, 'LT'),
(122, 'Люксембург', 269, 'LU'),
(123, 'Макао', 267, 'MO'),
(124, 'Македония', 245, 'MK'),
(125, 'Мадагаскар', 154, 'MG'),
(126, 'Малави', 166, 'MW'),
(127, 'Малайзия', 144, 'MY'),
(128, 'Мальдивы', 275, 'MV'),
(129, 'Мали', 168, 'ML'),
(130, 'Мальта', 271, 'MT'),
(131, 'Маршалловы Острова', 304, 'MH'),
(132, 'Мартиника', 274, 'MQ'),
(133, 'Мавритания', 238, 'MR'),
(134, 'Маврикий', 253, 'MU'),
(135, 'Майотта', 284, 'YT'),
(136, 'Мексика', 110, 'MX'),
(137, 'Микронезия', 291, 'FM'),
(138, 'Молдавия', 233, 'MD'),
(139, 'Монако', 316, 'MC'),
(140, 'Монголия', 241, 'MN'),
(141, 'Черногория', 265, 'ME'),
(142, 'Монтсеррат', 329, 'MS'),
(143, 'Марокко', 135, 'MA'),
(144, 'Мозамбик', 151, 'MZ'),
(145, 'Мьянма', 124, 'MM'),
(146, 'Намибия', 243, 'NA'),
(147, 'Науру', 326, 'NR'),
(148, 'Непал', 142, 'NP'),
(149, 'Нидерланды', 161, 'NL'),
(150, 'Новая Каледония', 281, 'NC'),
(151, 'Новая Зеландия', 222, 'NZ'),
(152, 'Никарагуа', 209, 'NI'),
(153, 'Нигер', 164, 'NE'),
(154, 'Нигерия', 106, 'NG'),
(155, 'Ниуэ', 333, 'NU'),
(156, 'Остров Норфолк', 331, 'NF'),
(157, 'Северная Корея', 148, 'KP'),
(158, 'Норвегия', 218, 'NO'),
(159, 'Оман', 231, 'OM'),
(160, 'Пакистан', 105, 'PK'),
(161, 'Палау', 320, 'PW'),
(162, 'Палестина', 226, 'PS'),
(163, 'Панама', 235, 'PA'),
(164, 'Папуа Новая Гвинея', 207, 'PG'),
(165, 'Парагвай', 205, 'PY'),
(166, 'Перу', 141, 'PE'),
(167, 'Филиппины', 111, 'PH'),
(168, 'Польша', 133, 'PL'),
(169, 'Португалия', 178, 'PT'),
(170, 'Пуэрто-Рико', 229, 'PR'),
(171, 'Катар', 249, 'QA'),
(172, 'Реюньон', 261, 'RE'),
(173, 'Румыния', 155, 'RO'),
(174, 'Россия', 1, 'RU'),
(175, 'Руанда', 173, 'RW'),
(176, 'Сен-Бартелеми', 327, 'BL'),
(177, 'Сент-Китс и Невис', 310, 'KN'),
(178, 'Сент-Люсия', 287, 'LC'),
(179, 'Сент-Мартен', 314, 'MF'),
(180, 'Сен-Пьер и Микелон', 328, 'PM'),
(181, 'Сент-Винсент и Гренадины', 290, 'VC'),
(182, 'Самоа', 285, 'WS'),
(183, 'Сан-Марино', 317, 'SM'),
(184, 'Сан-Томе и Принсипи', 288, 'ST'),
(185, 'Саудовская Аравия', 146, 'SA'),
(186, 'Сенегал', 170, 'SN'),
(187, 'Сербия', 201, 'RS'),
(188, 'Сейшельские Острова', 301, 'SC'),
(189, 'Сьерра-Леоне', 121, 'SL'),
(190, 'Сингапур', 216, 'SG'),
(191, 'Синт-Мартен', 313, 'SX'),
(192, 'Словакия', 214, 'SK'),
(193, 'Словения', 246, 'SI'),
(194, 'Соломоновы Острова', 268, 'SB'),
(195, 'Сомали', 185, 'SO'),
(196, 'ЮАР', 125, 'ZA'),
(197, 'Южная Корея', 126, 'KR'),
(198, 'Южный Судан', 194, 'SS'),
(199, 'Испания', 127, 'ES'),
(200, 'Шри-Ланка', 157, 'LK'),
(201, 'Судан', 138, 'SD'),
(202, 'Суринам', 270, 'SR'),
(203, 'Свазиленд', 256, 'SZ'),
(204, 'Швеция', 188, 'SE'),
(205, 'Швейцария', 197, 'CH'),
(206, 'Сирия', 153, 'SY'),
(207, 'Тайвань', 150, 'TW'),
(208, 'Таджикистан', 196, 'TJ'),
(209, 'Танзания', 130, 'TZ'),
(210, 'Таиланд', 119, 'TH'),
(211, 'Восточный Тимор', 257, 'TL'),
(212, 'Того', 204, 'TG'),
(213, 'Тонга', 294, 'TO'),
(214, 'Тринидад и Тобаго', 255, 'TT'),
(215, 'Тунис', 180, 'TN'),
(216, 'Турция', 117, 'TR'),
(217, 'Туркмения', 217, 'TM'),
(218, 'Острова Теркс и Кайкос', 312, 'TC'),
(219, 'Тувалу', 325, 'TV'),
(220, 'Уганда', 137, 'UG'),
(221, 'Украина', 2, 'UA'),
(222, 'ОАЭ', 193, 'AE'),
(223, 'Великобритания', 122, 'GB'),
(224, 'США', 102, 'US'),
(225, 'Американские Виргинские острова', 293, 'VI'),
(226, 'Уругвай', 234, 'UY'),
(227, 'Узбекистан', 145, 'UZ'),
(228, 'Вануату', 282, 'VU'),
(229, 'Венесуэла', 143, 'VE'),
(230, 'Вьетнам', 112, 'VN'),
(231, 'Уоллис и Футуна', 323, 'WF'),
(232, 'Йемен', 149, 'YE'),
(233, 'Замбия', 171, 'ZM'),
(234, 'Зимбабве', 172, 'ZW'),
(235, 'Северные Марианские острова', 302, 'MP');");

        $this->_table = 'geo_rus_region';
        $this->addColumn($this->_table, 'pos', 'int default 100');
        $this->update($this->_table, array('pos' => 1), 'id=42');
        $this->update($this->_table, array('pos' => 2), 'id=43');
        $this->update($this->_table, array('pos' => 3), 'id=59');
        $this->update($this->_table, array('pos' => 4), 'id=37');

        $this->_table = 'geo_rus_settlement';
        $this->addColumn($this->_table, 'population', 'int default 0');

        $this->_table = 'user';
        $this->dropColumn($this->_table, 'country');
        $this->dropColumn($this->_table, 'city');
        $this->addColumn($this->_table, 'country_id', 'int UNSIGNED after birthday');
        $this->addForeignKey($this->_table . '_country_fk', $this->_table, 'country_id', 'geo_country', 'id', 'CASCADE', "CASCADE");
    }

    public function down()
    {
        $this->dropColumn($this->_table, 'pos');
        $this->dropColumn($this->_table, 'iso_code');

        $this->_table = 'geo_rus_region';
        $this->dropColumn($this->_table, 'pos');

        $this->_table = 'geo_rus_settlement';
        $this->dropColumn($this->_table, 'population');

        $this->_table = 'user';
        $this->dropForeignKey($this->_table . '_country_fk', $this->_table);
        $this->dropColumn($this->_table, 'country_id');
        $this->addColumn($this->_table, 'country', 'varchar(256)');
        $this->addColumn($this->_table, 'city', 'varchar(256)');
    }
}
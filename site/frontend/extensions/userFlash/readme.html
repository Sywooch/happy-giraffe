<html>
	<head>
		<style type="text/css">
			* {font-family: Tahoma;}
			div.hl-code {border: 1px dotted #0066A4;background: #6699ff;font-family: Verdana;}
		</style>
	</head>
	<body>
		<div class="toc"><div class="ref level-2"><a href="#hh0">Requirements</a></div>
		<div class="ref level-2"><a href="#hh1">Usage</a></div>
		<div class="ref level-2"><a href="#hh2">Special usage</a></div>
		<div class="ref level-2"><a href="#hh3">Effects</a></div>
		<div class="ref level-2"><a href="#hh4">Changlog</a></div>
		<div class="ref level-2"><a href="#hh5">Similar extensions</a></div></div>

		<h2 id="hh1">Usage <a class="anchor" href="#hh1">¶</a></h2>

		<p>Extract the file 'EUserFlash.php' into protected/extensions</p>

		<p>You have to use the static methods of EUserFlash to generate flash messages.
		Flash messages added with 'Yii::app()-&gt;user-&gt;setFlash()' will not be rendered.</p>

		<p><strong>The predefined messages</strong></p>

		<ul><li>EUserFlash::setNoticeMessage($message,$context='',$logLevel='')</li>
		<li>EUserFlash::setSuccessMessage($message,$context='',$logLevel='')</li>
		<li>EUserFlash::setErrorMessage($message,$context='',$logLevel=CLogger::LEVEL_ERROR)</li>
		<li>EUserFlash::setWarningMessage($message,$context='',$logLevel=CLogger::LEVEL_WARNING)</li>
		</ul><p>You can define a context (list of keywords separated with a ',') when creating a message.
		You can register one or more terms of the context in the view when rendering the widget
		(see view code below)</p>

		<p>If you want to <strong>log the message</strong> on rendering you have to set a logLevel.
		On logging, additional info will be added:</p>

		<ul><li>user, ip address, controller route</li>
		<li>if messageType='error', $_GET and $_POST vars too (more info configurable)</li>
		</ul><p>The <strong>log category</strong> will be: 'userflash.messageType.context'.
		For example 'userflash.error', 'userflash.warning.login.activate' ....</p>

		<p>The widget renders the message inside a 'div' tag with the corresponding css classes:</p>

		<ul><li>flash-notice, flash-success, flash-error (default in blueprint css)</li>
		<li>flash-warning (you have to add to your css)</li>
		</ul><p>If you need other messagetypes you can use the <strong>custom method</strong>
		You can set your own cssClass when generating the message (if empty it will be 'flash-default').</p>

		<ul><li>EUserFlash::setMessage($message,$context='',$cssClass='',$logLevel='',$messageType='default')</li>
		</ul><p>Controller code example:</p>

		<div class="hl-code"><div class="hl-main"><pre><span class="hl-identifier">Yii</span><span class="hl-code">::</span><span class="hl-identifier">import</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">ext.EUserFlash</span><span class="hl-quotes">'</span><span class="hl-brackets">)</span><span class="hl-code">;

		...
		</span><span class="hl-identifier">EUserFlash</span><span class="hl-code">::</span><span class="hl-identifier">setSuccessMessage</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">This is a success message.</span><span class="hl-quotes">'</span><span class="hl-brackets">)</span><span class="hl-code">;
		...
		</span><span class="hl-comment">//</span><span class="hl-comment">An error message with the context login and activate</span>
		<span class="hl-comment">//</span><span class="hl-comment">The widget must register one of the context terms for rendering this flash message </span>
		<span class="hl-identifier">EUserFlash</span><span class="hl-code">::</span><span class="hl-identifier">setErrorMessage</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">This is a error message.</span><span class="hl-quotes">'</span><span class="hl-code">,</span><span class="hl-quotes">'</span><span class="hl-string">login,activate</span><span class="hl-quotes">'</span><span class="hl-brackets">)</span><span class="hl-code">;
		...</span></pre></div></div>

		<p>If you add multiple lines in a controller actions code. You decide in the view,
		which of these messages (or all) you want to render.</p>

		<p>The view code - $this is the controller in the view:</p>

		<div class="hl-code"><div class="hl-main"><pre><span class="hl-inlinetags">&lt;?php</span>
		   <span class="hl-comment">//</span><span class="hl-comment">this will render all flashes, independent of the context</span>
		   <span class="hl-var">$this</span><span class="hl-code">-&gt;</span><span class="hl-identifier">widget</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">ext.EUserFlash</span><span class="hl-quotes">'</span><span class="hl-brackets">)</span><span class="hl-code">;

		   </span><span class="hl-comment">//</span><span class="hl-comment">this is equivalent, but will return the count of rendered message if needed</span>
		   <span class="hl-comment">//</span><span class="hl-comment">see Special usage</span>
		   <span class="hl-identifier">EUserFlash</span><span class="hl-code">::</span><span class="hl-identifier">renderFlashes</span><span class="hl-brackets">(</span><span class="hl-var">$this</span><span class="hl-brackets">)</span><span class="hl-code">;

		  </span><span class="hl-inlinetags">?&gt;</span><span class="hl-code">

		&lt;?</span><span class="hl-identifier">php</span>
		   <span class="hl-comment">//</span><span class="hl-comment">this will render all messages, generated with empty context</span>
		   <span class="hl-var">$this</span><span class="hl-code">-&gt;</span><span class="hl-identifier">widget</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">ext.EUserFlash</span><span class="hl-quotes">'</span><span class="hl-code">,</span><span class="hl-reserved">array</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">context</span><span class="hl-quotes">'</span><span class="hl-code">=&gt;</span><span class="hl-quotes">'</span><span class="hl-quotes">'</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code">;
		   </span><span class="hl-comment">//</span><span class="hl-comment">the same</span>
		   <span class="hl-identifier">EUserFlash</span><span class="hl-code">::</span><span class="hl-identifier">renderFlashes</span><span class="hl-brackets">(</span><span class="hl-var">$this</span><span class="hl-code">,</span><span class="hl-reserved">array</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">context</span><span class="hl-quotes">'</span><span class="hl-code">=&gt;</span><span class="hl-quotes">'</span><span class="hl-quotes">'</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code">;
		</span><span class="hl-inlinetags">?&gt;</span><span class="hl-code">

		&lt;?</span><span class="hl-identifier">php</span>

		   <span class="hl-comment">//</span><span class="hl-comment">this will render all messages with the context 'login'</span>
		   <span class="hl-comment">//</span><span class="hl-comment">inside a span with the class my-flash-error-class' if an error message is rendered.</span>
		   <span class="hl-comment">//</span><span class="hl-comment">use EUserFlash::renderFlashes(...) the same way.</span>
		   <span class="hl-var">$this</span><span class="hl-code">-&gt;</span><span class="hl-identifier">widget</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">ext.EUserFlash</span><span class="hl-quotes">'</span><span class="hl-code">,</span><span class="hl-reserved">array</span><span class="hl-brackets">(</span>
		           <span class="hl-quotes">'</span><span class="hl-string">context</span><span class="hl-quotes">'</span><span class="hl-code">=&gt;</span><span class="hl-quotes">'</span><span class="hl-string">login</span><span class="hl-quotes">'</span><span class="hl-code">,
		           </span><span class="hl-quotes">'</span><span class="hl-string">cssClassError</span><span class="hl-quotes">'</span><span class="hl-code">=&gt;</span><span class="hl-quotes">'</span><span class="hl-string">my-flash-error-class</span><span class="hl-quotes">'</span><span class="hl-code">,
		           </span><span class="hl-quotes">'</span><span class="hl-string">tag</span><span class="hl-quotes">'</span><span class="hl-code">=&gt;</span><span class="hl-quotes">'</span><span class="hl-string">span</span><span class="hl-quotes">'</span>
		      <span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code">;
		</span><span class="hl-inlinetags">?&gt;</span><span class="hl-code">

		&lt;?</span><span class="hl-identifier">php</span>
		   <span class="hl-comment">//</span><span class="hl-comment">this will render all messages with the context 'login' or 'activate'</span>
		   <span class="hl-var">$this</span><span class="hl-code">-&gt;</span><span class="hl-identifier">widget</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">ext.EUserFlash</span><span class="hl-quotes">'</span><span class="hl-code">,</span><span class="hl-reserved">array</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">context</span><span class="hl-quotes">'</span><span class="hl-code">=&gt;</span><span class="hl-quotes">'</span><span class="hl-string">login,activate</span><span class="hl-quotes">'</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code">;
		</span><span class="hl-inlinetags">?&gt;</span><span class="hl-code">


		&lt;?</span><span class="hl-identifier">php</span>
		   <span class="hl-comment">//</span><span class="hl-comment">all options with the default values</span>
		   <span class="hl-comment">//</span><span class="hl-comment">see the comments in the code</span>

		   <span class="hl-var">$this</span><span class="hl-code">-&gt;</span><span class="hl-identifier">widget</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">ext.EUserFlash</span><span class="hl-quotes">'</span><span class="hl-code">,
		        </span><span class="hl-reserved">array</span><span class="hl-brackets">(</span>
		                <span class="hl-quotes">'</span><span class="hl-string">loggingEnabled</span><span class="hl-quotes">'</span><span class="hl-code"> = </span><span class="hl-reserved">true</span><span class="hl-code">,
		                </span><span class="hl-quotes">'</span><span class="hl-string">errorLogVars</span><span class="hl-quotes">'</span><span class="hl-code"> = </span><span class="hl-reserved">array</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">_GET</span><span class="hl-quotes">'</span><span class="hl-code">,</span><span class="hl-quotes">'</span><span class="hl-string">_POST</span><span class="hl-quotes">'</span><span class="hl-brackets">)</span><span class="hl-code">,
		                </span><span class="hl-quotes">'</span><span class="hl-string">context</span><span class="hl-quotes">'</span><span class="hl-code">=&gt;</span><span class="hl-reserved">null</span><span class="hl-code">,
		                </span><span class="hl-quotes">'</span><span class="hl-string">deleteMessages</span><span class="hl-quotes">'</span><span class="hl-code"> = </span><span class="hl-reserved">true</span><span class="hl-code">,
		                </span><span class="hl-quotes">'</span><span class="hl-string">tag</span><span class="hl-quotes">'</span><span class="hl-code"> = </span><span class="hl-quotes">'</span><span class="hl-string">div</span><span class="hl-quotes">'</span><span class="hl-code">,
		                </span><span class="hl-quotes">'</span><span class="hl-string">cssClassDefault</span><span class="hl-quotes">'</span><span class="hl-code"> = </span><span class="hl-quotes">'</span><span class="hl-string">flash-default</span><span class="hl-quotes">'</span><span class="hl-code">,
		                </span><span class="hl-quotes">'</span><span class="hl-string">cssClassNotice</span><span class="hl-quotes">'</span><span class="hl-code"> = </span><span class="hl-quotes">'</span><span class="hl-string">flash-notice</span><span class="hl-quotes">'</span><span class="hl-code">,
		                </span><span class="hl-quotes">'</span><span class="hl-string">cssClassError</span><span class="hl-quotes">'</span><span class="hl-code"> = </span><span class="hl-quotes">'</span><span class="hl-string">flash-error</span><span class="hl-quotes">'</span><span class="hl-code">,
		                </span><span class="hl-quotes">'</span><span class="hl-string">cssClassWarning</span><span class="hl-quotes">'</span><span class="hl-code"> = </span><span class="hl-quotes">'</span><span class="hl-string">flash-warning</span><span class="hl-quotes">'</span><span class="hl-code">,
		                </span><span class="hl-quotes">'</span><span class="hl-string">cssClassSuccess</span><span class="hl-quotes">'</span><span class="hl-code"> = </span><span class="hl-quotes">'</span><span class="hl-string">flash-success</span><span class="hl-quotes">'</span><span class="hl-code">,
		                </span><span class="hl-quotes">'</span><span class="hl-string">initScript</span><span class="hl-quotes">'</span><span class="hl-code">=&gt;</span><span class="hl-reserved">null</span><span class="hl-code">,
		                </span><span class="hl-quotes">'</span><span class="hl-string">htmlOptions</span><span class="hl-quotes">'</span><span class="hl-code"> = </span><span class="hl-reserved">array</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span>

		          <span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code">;
		</span><span class="hl-inlinetags">?&gt;</span></pre></div></div>

		<h2 id="hh2">Special usage <a class="anchor" href="#hh2">¶</a></h2>

		<p>If you have to change the output in the view depending on rendered messages you have
		to use the static method 'renderFlashes' instead of $this-&gt;widget('ext.EUserFlash'...);
		This is because the widget run method has no return value.</p>

		<p>Your code in the view - $this is the controller</p>

		<div class="hl-code"><div class="hl-main"><pre><span class="hl-inlinetags">&lt;?php</span> <span class="hl-reserved">if</span> <span class="hl-brackets">(</span><span class="hl-code">!</span><span class="hl-identifier">EUserFlash</span><span class="hl-code">::</span><span class="hl-identifier">renderFlashes</span><span class="hl-brackets">(</span><span class="hl-var">$this</span><span class="hl-code">,</span><span class="hl-reserved">array</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">context</span><span class="hl-quotes">'</span><span class="hl-code">=&gt;</span><span class="hl-quotes">'</span><span class="hl-string">loginerror</span><span class="hl-quotes">'</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code">: ?&gt;
		  ...
		  </span><span class="hl-comment">//</span><span class="hl-comment"> output if no message with the context 'loginerror' is rendered </span><span class="hl-code">
		   ...
		&lt;?</span><span class="hl-identifier">php</span> <span class="hl-reserved">endif</span><span class="hl-code">; ?&gt;</span></pre></div></div>

		<p>'renderFlashes' returns 'renderedCount', so you can do something like this in the view too:</p>

		<div class="hl-code"><div class="hl-main"><pre><span class="hl-reserved">if</span> <span class="hl-brackets">(</span><span class="hl-brackets">(</span><span class="hl-var">$count</span><span class="hl-code"> = </span><span class="hl-identifier">EUserFlash</span><span class="hl-code">::</span><span class="hl-identifier">renderFlashes</span><span class="hl-brackets">(</span><span class="hl-var">$this</span><span class="hl-code">,</span><span class="hl-reserved">array</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">context</span><span class="hl-quotes">'</span><span class="hl-code">=&gt;</span><span class="hl-quotes">'</span><span class="hl-quotes">'</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code"> &gt; </span><span class="hl-number">0</span><span class="hl-brackets">)</span>
		     <span class="hl-reserved">echo</span> <span class="hl-var">$count</span><span class="hl-code"> . </span><span class="hl-quotes">'</span><span class="hl-string"> messages rendered</span><span class="hl-quotes">'</span><span class="hl-code">;
		   </span><span class="hl-reserved">else</span>
		     <span class="hl-reserved">echo</span> <span class="hl-quotes">'</span><span class="hl-string">No messages rendered</span><span class="hl-quotes">'</span><span class="hl-code">;</span></pre></div></div>

		<h2 id="hh3">Effects <a class="anchor" href="#hh3">¶</a></h2>

		<p>If the property <strong>initScript</strong> of the widget is assigned, this string will be rendered as js-code (clientScript).
		Use this property to add jquery code for effects. You can use the always added css classes 'userflash' and depending on the messageType: userflash_success, userflash_error ...
		to select the 'div' tags and assign effect (or other) jquery methods like fadeIn, fadeOut, animate ...</p>

		<div class="hl-code"><div class="hl-main"><pre><span class="hl-comment">//</span><span class="hl-comment">fade out the success and notice messages, error and warning with no effects</span>
		<span class="hl-var">$this</span><span class="hl-code">-&gt;</span><span class="hl-identifier">widget</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">ext.EUserFlash</span><span class="hl-quotes">'</span><span class="hl-code">,</span><span class="hl-reserved">array</span><span class="hl-brackets">(</span>
		 <span class="hl-quotes">'</span><span class="hl-string">initScript</span><span class="hl-quotes">'</span><span class="hl-code">=&gt;</span><span class="hl-quotes">"</span><span class="hl-string">$('.userflash_success').fadeOut(10000);$('.userflash_notice').fadeOut(10000);</span><span class="hl-quotes">"</span>
		<span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code">;

		</span><span class="hl-comment">//</span><span class="hl-comment">fade in all messagetypes</span>
		<span class="hl-var">$this</span><span class="hl-code">-&gt;</span><span class="hl-identifier">widget</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">ext.EUserFlash</span><span class="hl-quotes">'</span><span class="hl-code">,</span><span class="hl-reserved">array</span><span class="hl-brackets">(</span>
		  <span class="hl-quotes">'</span><span class="hl-string">initScript</span><span class="hl-quotes">'</span><span class="hl-code">=&gt;</span><span class="hl-quotes">"</span><span class="hl-string">$('.userflash').fadeIn(3000);</span><span class="hl-quotes">"</span><span class="hl-code">,
		  </span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code">;

		</span><span class="hl-comment">//</span><span class="hl-comment">fade in and out notice messages</span>
		<span class="hl-var">$this</span><span class="hl-code">-&gt;</span><span class="hl-identifier">widget</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">ext.EUserFlash</span><span class="hl-quotes">'</span><span class="hl-code">,</span><span class="hl-reserved">array</span><span class="hl-brackets">(</span>
		  <span class="hl-quotes">'</span><span class="hl-string">initScript</span><span class="hl-quotes">'</span><span class="hl-code">=&gt;</span><span class="hl-quotes">"</span><span class="hl-string">$('.userflash_notice').fadeIn(3000).fadeOut(10000);</span><span class="hl-quotes">"</span><span class="hl-code">,
		  </span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code">;</span></pre></div></div>

		<p>You can play around with chained methods <em>animate(...).animate(...)</em> too or other jquery stuff (fancybox ...).</p>

		<h2 id="hh4">Changlog <a class="anchor" href="#hh4">¶</a></h2>

		<ul><li>v1.2 added logging feature, added method setWarningMessage</li>
		<li>v1.3 added initScript property for jquery effects, css classes 'userflash', 'userflash_success' ...</li>
		</ul><h2 id="hh5">Similar extensions <a class="anchor" href="#hh5">¶</a></h2>

		<ul><li><a href="http://www.yiiframework.com/extension/yii-flash" title="">yii-flash</a></li>
		<li><a href="http://www.yiiframework.com/extension/messagestack" title="">messagestack</a></li>
		</ul>
	</body>
</html>